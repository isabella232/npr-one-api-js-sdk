!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NprOneSDK=t():e.NprOneSDK=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}t.__esModule=!0;var o=n(22),i=r(o);i.useDefaults({formatter:function(e,t){e.unshift("[NPROneSDK]"),t.name&&e.unshift("["+t.name+"]")}}),t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0,t.User=t.Station=t.Recommendation=t.DeviceCode=t.Action=t.NprOneSDK=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(15);var a=n(17),s=r(a),u=n(19),c=r(u),f=n(18),l=r(f),d=n(7),h=r(d),p=n(5),y=r(p),m=n(10),g=r(m),v=n(12),w=r(v),b=n(13),_=r(b),T=n(14),k=r(T),R=n(1),S=r(R);S.default.setLevel(S.default.WARN);var A=t.NprOneSDK=function(){function e(){o(this,e),this._accessTokenChangedCallback=null,this._refreshTokenChangedCallback=null,this._authorization=new s.default,this._listening=new c.default,this._identity=new l.default,this._stationfinder=new h.default,e._initConfig()}return e.refreshExistingAccessToken=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return s.default.refreshExistingAccessToken(e)},e.prototype.logout=function(){return this._authorization.logout()},e.prototype.getDeviceCode=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this._authorization.getDeviceCode(e)},e.prototype.pollDeviceCode=function(){return this._authorization.pollDeviceCode()},e.prototype.getRecommendation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"npr";return this._listening.getRecommendation(e,t)},e.prototype.resumeFlowFromRecommendation=function(e){return this._listening.resumeFlowFromRecommendation(e)},e.prototype.getUpcomingFlowRecommendations=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"npr";return this._listening.getUpcomingFlowRecommendations(e)},e.prototype.getRecommendationsFromChannel=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"recommended";return this._listening.getRecommendationsFromChannel(e)},e.prototype.queueRecommendationFromChannel=function(e,t){return this._listening.queueRecommendationFromChannel(e,t)},e.prototype.getHistory=function(){return this._listening.getHistory()},e.prototype.resetFlow=function(){return this._listening.resetFlow()},e.prototype.getUser=function(){return this._identity.getUser()},e.prototype.setUserStation=function(e){return this._identity.setUserStation(e)},e.prototype.followShow=function(e){return this._identity.followShow(e)},e.prototype.unfollowShow=function(e){return this._identity.unfollowShow(e)},e.prototype.createTemporaryUser=function(){return this._identity.createTemporaryUser()},e.prototype.searchStations=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._stationfinder.searchStations(e)},e.prototype.searchStationsByLatLongCoordinates=function(e,t){return this._stationfinder.searchStationsByLatLongCoordinates(e,t)},e.prototype.searchStationsByCityAndState=function(e,t){return this._stationfinder.searchStationsByCityAndState(e,t)},e.prototype.searchStationsByCity=function(e){return this._stationfinder.searchStationsByCity(e)},e.prototype.searchStationsByState=function(e){return this._stationfinder.searchStationsByState(e)},e.prototype.getStationDetails=function(e){return this._stationfinder.getStationDetails(e)},e.getServiceUrl=function(t){switch(t){case"authorization":return"https://"+e.config.subdomain+"authorization.api.npr.org/v2";case"identity":return"https://"+e.config.subdomain+"identity.api.npr.org/v2";case"listening":return"https://"+e.config.subdomain+"listening.api.npr.org/v2";case"stationfinder":return"https://"+e.config.subdomain+"station.api.npr.org/v3";default:throw new TypeError("Must specify a valid service name")}},e._initConfig=function(){e._config||(e._config={authProxyBaseUrl:"",newDeviceCodePath:"/device",pollDeviceCodePath:"/device/poll",refreshTokenPath:"/refresh",tempUserPath:"/temporary",logoutPath:"/logout",accessToken:"",refreshToken:"",clientId:"",advertisingId:"",advertisingTarget:"",subdomain:""})},i(e,null,[{key:"config",get:function(){return e._initConfig(),e._config},set:function(t){t.apiBaseUrl&&S.default.warn('Property "apiBaseUrl" in config is deprecated and will be removed in a future release. Please use the "subdomain" property instead if a different API URL is needed.'),t.apiVersion&&S.default.warn('Property "apiVersion" in config is deprecated and will be removed in a future release.'),e._initConfig(),Object.assign(e._config,t)}},{key:"accessToken",get:function(){return e.config.accessToken},set:function(t){if("string"!=typeof t)throw new TypeError("Value for accessToken must be a string");var n=e.accessToken;e.config.accessToken=t,n!==t&&"function"==typeof e._accessTokenChangedCallback&&e._accessTokenChangedCallback(t)}},{key:"onAccessTokenChanged",set:function(t){if("function"!=typeof t)throw new TypeError("Value for onAccessTokenChanged must be a function");e._accessTokenChangedCallback=t}},{key:"refreshToken",get:function(){return e.config.refreshToken},set:function(t){if("string"!=typeof t)throw new TypeError("Value for refreshToken must be a string");var n=e.refreshToken;e.config.refreshToken=t,n!==t&&"function"==typeof e._refreshTokenChangedCallback&&e._refreshTokenChangedCallback(t)}},{key:"onRefreshTokenChanged",set:function(t){if("function"!=typeof t)throw new TypeError("Value for onRefreshTokenChanged must be a function");e._refreshTokenChangedCallback=t}},{key:"Action",get:function(){return y.default}},{key:"Logger",get:function(){return S.default}}]),e}();t.default=A,t.Action=y.default,t.DeviceCode=g.default,t.Recommendation=w.default,t.Station=_.default,t.User=k.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(1),a=r(i),s=n(2),u=r(s),c=n(8),f=r(c),l=function(e){return new Promise(function(t){return setTimeout(t,e)})},d=function(){function e(){o(this,e)}return e.nprApiFetch=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.default.debug("Starting JSON fetch "+t),e._requestUrlIsAuthorizationCall(t)||n.headers||(n.headers=e._getHeaders()),fetch(t,n).then(function(r){return r.ok?r.json():401===r.status&&Boolean(u.default.accessToken)&&!e._requestUrlIsAuthorizationCall(t)?e._attemptAccessTokenRefresh(t,n):e.formatErrorResponse(r)})},e.formatErrorResponse=function(e){return e.json().then(function(t){throw new f.default(e,t)},function(t){throw a.default.debug("Problem deserializing JSON from API error"),a.default.debug(t),new f.default(e)})},e._attemptAccessTokenRefresh=function(t,n){var r=this;return u.default.refreshExistingAccessToken().then(function(){var o=n;return n.headers&&(o.headers=e._getHeaders()),l(250).then(e.nprApiFetch.bind(r,t,o))})},e._getHeaders=function(){if(""===u.default.accessToken)throw new Error("An Access Token must set before making API requests.");var e=new Headers;return e.append("Authorization","Bearer "+u.default.accessToken),u.default.config.advertisingId&&e.append("X-Advertising-ID",""+u.default.config.advertisingId),u.default.config.advertisingTarget&&e.append("X-Advertising-Target",""+u.default.config.advertisingTarget),e},e._requestUrlIsAuthorizationCall=function(e){return u.default.config.authProxyBaseUrl&&e.indexOf(u.default.config.authProxyBaseUrl)>-1||new RegExp(u.default.getServiceUrl("authorization")).test(e)},e}();t.default=d},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(){n(this,e)}return e.validateCollectionDoc=function(t){var n=["version","href","attributes","items","links","errors"];e._validate(t,n)},e.validateAccessToken=function(t){var n=["access_token","token_type","expires_in"];e._validate(t,n)},e.validateDeviceCode=function(t){var n=["user_code","verification_uri","expires_in","interval"];e._validate(t,n)},e._validate=function(t,n){for(var r=[],o=n,i=Array.isArray(o),a=0,o=i?o:o[Symbol.iterator]();;){var s;if(i){if(a>=o.length)break;s=o[a++]}else{if(a=o.next(),a.done)break;s=a.value}var u=s;e._has(t,u)||r.push("'"+u+"' is missing and is required.")}if(r.length>0)throw new TypeError(r.join(", ")+" :"+JSON.stringify(t))},e._has=function(e,t){return!!e&&{}.hasOwnProperty.call(e,t)},e}();t.default=r},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return e.getEndActions=function(){return[e.COMPLETED,e.SKIP,e.TIMEOUT,e.SRCHCOMPL]},e.getFlowAdvancingActions=function(){return[e.START,e.TAPTHRU,e.TIMEOUT]},e.isValidAction=function(t){return{}.hasOwnProperty.call(e,t)},r(e,null,[{key:"COMPLETED",get:function(){return"COMPLETED"}},{key:"PASS",get:function(){return"PASS"}},{key:"SHARE",get:function(){return"SHARE"}},{key:"SKIP",get:function(){return"SKIP"}},{key:"SRCHCOMPL",get:function(){return"SRCHCOMPL"}},{key:"SRCHSTART",get:function(){return"SRCHSTART"}},{key:"START",get:function(){return"START"}},{key:"THUMBUP",get:function(){return"THUMBUP"}},{key:"TIMEOUT",get:function(){return"TIMEOUT"}},{key:"TAPTHRU",get:function(){return"TAPTHRU"}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),s=r(a),u=function(){function e(t){o(this,e),this._raw=t}return e.prototype._validate=function(){s.default.validateCollectionDoc(this._raw)},i(e,[{key:"collectionDoc",get:function(){return this._raw}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(2),a=r(i),s=n(3),u=r(s),c=n(13),f=r(c),l=function(){function e(){o(this,e)}return e.prototype.searchStations=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._performStationSearch(e)},e.prototype.searchStationsByLatLongCoordinates=function(e,t){return this._performStationSearch(null,e,t)},e.prototype.searchStationsByCityAndState=function(e,t){return this._performStationSearch(null,null,null,e,t)},e.prototype.searchStationsByCity=function(e){return this._performStationSearch(null,null,null,e)},e.prototype.searchStationsByState=function(e){return this._performStationSearch(null,null,null,null,e)},e.prototype.getStationDetails=function(t){return e.validateStation(t)},e.validateStation=function(e){var t=parseInt(e,10);if(isNaN(t)||!isFinite(t))return Promise.reject(new Error("Station ID must be an integer greater than 0"));var n=a.default.getServiceUrl("stationfinder")+"/stations/"+e;return u.default.nprApiFetch(n).then(function(e){var t=new f.default(e);if(!t.isNprOneEligible)throw new Error("The station "+t.id+" is not eligible for NPR One.");return t})},e.prototype._performStationSearch=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=a.default.getServiceUrl("stationfinder")+"/stations",s="";if(e){if("string"!=typeof e)throw new TypeError("Station search query must be a string");s="q="+e}else if(t||n){if("number"!=typeof t||"number"!=typeof n)throw new TypeError("Latitude and longitude must both be valid numbers (floats)");s="lat="+t+"&lon="+n}else{if(r){if("string"!=typeof r)throw new TypeError("Station search city name must be a string");s+="city="+r}if(o){if("string"!=typeof o)throw new TypeError("Station search state name must be a string");s+="state="+o}}return u.default.nprApiFetch(s?i+"?"+s:i).then(function(e){var t=[];if(e&&e.items&&e.items.length)for(var n=e.items,r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i,s=new f.default(a);s.isNprOneEligible&&t.push(s)}return t})},e}();t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):o(e,t))}t.__esModule=!0;var u=n(21),c=r(u),f=function(e){function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t);var o=a(this,e.call(this,"Response status: "+n.status+" "+n.statusText));return o.statusCode=n.status,o.statusText=n.statusText,o.headers=n.headers,o.responseType=n.type,o.responseUrl=n.url,o.json=r,o}return s(t,e),t}(c.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),s=r(a),u=function(){function e(t){o(this,e),this._raw=t,this._expiryDate=null,isNaN(this._raw.expires_in)||(this._expiryDate=new Date(Date.now()+this.ttl))}return e.prototype.validate=function(){s.default.validateAccessToken(this._raw)},e.prototype.isExpired=function(){return null!==this._expiryDate&&new Date>=this._expiryDate},e.prototype.toString=function(){return this._raw.access_token},i(e,[{key:"token",get:function(){return this._raw.access_token}},{key:"refreshToken",get:function(){return this._raw.refresh_token||null}},{key:"ttl",get:function(){return 1e3*this._raw.expires_in}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),s=r(a),u=function(){function e(t){o(this,e),this._raw=t,this._expiryDate=null,isNaN(this._raw.expires_in)||(this._expiryDate=new Date(Date.now()+this.ttl))}return e.prototype.validate=function(){s.default.validateDeviceCode(this._raw)},e.prototype.isExpired=function(){return null!==this._expiryDate&&new Date>=this._expiryDate},e.prototype.toString=function(){return JSON.stringify(this._raw)},i(e,[{key:"deviceCode",get:function(){return this._raw.device_code||null}},{key:"userCode",get:function(){return this._raw.user_code}},{key:"verificationUri",get:function(){return this._raw.verification_uri}},{key:"ttl",get:function(){return 1e3*this._raw.expires_in}},{key:"interval",get:function(){return 1e3*this._raw.interval}}]),e}();t.default=u},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var r=function(){function e(t){n(this,e),Object.assign(this,t),this._hasSent=!1,this._recommendationUrl="",this._actionUrl=""}return e.privateMemberReplacer=function(e,t){if(!(["_hasSent","_recommendationUrl","_actionUrl"].indexOf(e)>=0))return t},e.prototype.toString=function(){return"[RID="+this.mediaId+", R="+this.rating+"]"},e}();t.default=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):o(e,t))}t.__esModule=!0,n(15);var u=n(16),c=r(u),f=n(6),l=r(f),d=n(11),h=r(d),p=n(5),y=r(p),m=n(1),g=r(m),v=function(e){function t(n){i(this,t);var r=a(this,e.call(this,n));return r._raw=n,r.attributes={},r.ratings=[],r.audio=[],r.recommendations=[],r.images=[],r.web=[],r.onramps=[],r.callsToAction=[],r.impressions=[],r.relateds=[],r.relatedImpressions=[],r._ratingTemplate={},r._hasSentImpressions=!1,r._ratingReceivedCallback=null,r._hydrate(),r}return s(t,e),t.prototype._hydrate=function(){this._validate(),this._ratingTemplate=this._raw.attributes.rating,this.attributes=Object.assign({},this._raw.attributes),delete this.attributes.rating;var e=this._raw.links;this.audio=e.audio,this.recommendations=e.recommendations,this.web=e.web?e.web:[],this.images=e.image?e.image:[],this.onramps=e.onramps?e.onramps:[],this.callsToAction=e.action?e.action:[],this.impressions=e.impression?e.impression:[],this.relateds=e.related?e.related:[],this.relatedImpressions=e["related-impression"]?e["related-impression"]:[]},t.prototype._validate=function(){var e=this._raw.links;if(!e.audio||e.audio.constructor!==Array||e.audio.length<=0)throw new TypeError("Audio must exist within links.");if(!e.recommendations||e.recommendations.constructor!==Array||e.recommendations.length<=0)throw new TypeError("Recommendation (contains URL) must exist within links.");if(!this._raw.attributes.rating)throw new TypeError("Attributes must contain a rating object.")},t.prototype.getImages=function(){return this.images},t.prototype.getAudio=function(){return this.audio},t.prototype.getWeb=function(){return this.web},t.prototype.getOnRamps=function(){return this.onramps},t.prototype.getImpressions=function(){return this.impressions},t.prototype.getCallsToAction=function(){return this.callsToAction},t.prototype.getRelateds=function(){return this.relateds},t.prototype.getRelatedImpressions=function(){return this.relatedImpressions},t.prototype.getRatings=function(){return this.ratings},t.prototype.getRecommendationUrl=function(){return this.recommendations[0].href},t.prototype.getActionRecommendationUrl=function(){for(var e=new c.default(this.getRecommendationUrl()),t=this.callsToAction.concat(this.relateds),n="",r=t,o=Array.isArray(r),i=0,r=o?r:r[Symbol.iterator]();;){var a;if(o){if(i>=r.length)break;a=r[i++]}else{if(i=r.next(),i.done)break;a=i.value}var s=a;if(s.href&&0===s.href.indexOf("nprone://")){n=new c.default(s.href);break}}var u="";return n&&(u=e.set("query",n.query).href+"&recommend=true"),u},t.prototype.isSponsorship=function(){return"sponsorship"===this.attributes.type},t.prototype.isShareable=function(){return this.onramps.length>0},t.prototype.hasAction=function(e){for(var t=this.ratings,n=Array.isArray(t),r=0,t=n?t:t[Symbol.iterator]();;){var o;if(n){if(r>=t.length)break;o=t[r++]}else{if(r=t.next(),r.done)break;o=r.value}var i=o;if(i.rating===e)return!0}return!1},t.prototype.hasEndAction=function(){for(var e=y.default.getEndActions(),t=Array.isArray(e),n=0,e=t?e:e[Symbol.iterator]();;){var r;if(t){if(n>=e.length)break;r=e[n++]}else{if(n=e.next(),n.done)break;r=n.value}var o=r;if(this.hasAction(o))return!0}return!1},t.prototype.recordAction=function(e,t){var n=t;if(!y.default.isValidAction(e))throw new Error(e+" action is invalid. See Action class for valid actions.");var r=parseInt(n,10);if(isNaN(r)||!isFinite(r))throw new Error("Elapsed time must be supplied and be a positive integer value.");n<0&&(g.default.warn("Elapsed time of "+n+" is invalid and has been changed to 0 seconds."),n=0),n>this.attributes.duration&&this.attributes.duration>0&&(n>this.attributes.duration+30&&g.default.warn("Elapsed time of "+n+" exceeds overall audio duration "+("and has been modified to "+this.attributes.duration+" seconds.")),n=this.attributes.duration),0!==n||e!==y.default.COMPLETED&&e!==y.default.SKIP||g.default.warn("Elapsed time value should be greater than zero; please ensure the time passed since the START rating is recorded."),e!==y.default.START&&(this.hasAction(y.default.START)||g.default.warn("Action '"+e+"' has been recorded; however, no START action exists. Please ensure START actions are recorded first."));var o=new h.default(this._ratingTemplate);if(o.rating=e,o.elapsed=n,o.timestamp=(new Date).toISOString(),o._recommendationUrl=this.getRecommendationUrl(),o._actionUrl=this.getActionRecommendationUrl(),this.isSponsorship()&&e===y.default.START&&!this._hasSentImpressions){this._hasSentImpressions=!0;var i=this.impressions.concat(this.relatedImpressions);i.forEach(function(e){"audio"===e["form-factor"]&&fetch(e.href,{mode:"no-cors"})})}this.ratings.push(o),null!==this._ratingReceivedCallback&&this._ratingReceivedCallback(o)},t.prototype.setRatingReceivedCallback=function(e){this._ratingReceivedCallback=e},t.prototype.toString=function(){return"[UID="+this.attributes.uid+", R="+this.getRatings().join(",")+"]"},t}(l.default);t.default=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):o(e,t))}t.__esModule=!0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(6),f=r(c),l=function(e){function t(n){i(this,t);var r=a(this,e.call(this,n));return r._validate(),r}return s(t,e),t.prototype.toString=function(){return this.displayName},u(t,[{key:"id",get:function(){return this._raw.attributes.orgId}},{key:"displayName",get:function(){return this._raw.attributes.brand.name}},{key:"logo",get:function(){if(this._raw.links.brand)for(var e=this._raw.links.brand,t=Array.isArray(e),n=0,e=t?e:e[Symbol.iterator]();;){var r;if(t){if(n>=e.length)break;r=e[n++]}else{if(n=e.next(),n.done)break;r=n.value}var o=r;if("logo"===o.rel)return o.href}return null}},{key:"tagline",get:function(){return this._raw.attributes.brand.tagline||""}},{key:"callSignAndFrequency",get:function(){var e="",t=this._raw.attributes.brand;return t.call&&(e+=t.call),t.band&&(e+=" "+t.band),t.frequency&&(e+=" "+t.frequency),e.trim()||null}},{key:"location",get:function(){var e=this._raw.attributes.brand;return e.marketCity+", "+e.marketState}},{key:"homepageUrl",get:function(){if(this._raw.links.brand)for(var e=this._raw.links.brand,t=Array.isArray(e),n=0,e=t?e:e[Symbol.iterator]();;){var r;if(t){if(n>=e.length)break;r=e[n++]}else{if(n=e.next(),n.done)break;r=n.value}var o=r;if("homepage"===o.rel)return o.href}return null}},{key:"donationUrl",get:function(){var e=void 0,t=void 0;if(this._raw.links.donation)for(var n=this._raw.links.donation,r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;if("27"===a.typeId){e=a.href;break}"4"===a.typeId&&(t=a.href)}return e||t||null}},{key:"primaryStream",get:function(){return this._raw.links.streams?this._raw.links.streams.find(function(e){return e.isPrimaryStream}):null}},{key:"primaryStreamUrl",get:function(){var e=this.primaryStream;return e?e.href:null}},{key:"isNprOneEligible",get:function(){return this._raw.attributes.eligibility.nprOne}},{key:"attributes",get:function(){return this._raw.attributes}}]),t}(f.default);t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(t,o);i&&i.configurable&&void 0===e[o]&&Object.defineProperty(e,o,i)}return e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):o(e,t))}t.__esModule=!0;var u=n(6),c=r(u),f=function(e){function t(n){i(this,t);var r=a(this,e.call(this,n));return r._raw=n,r.attributes={},r._hydrate(),r}return s(t,e),t.prototype._hydrate=function(){this._validate(),this.attributes=this._raw.attributes},t.prototype.isTemporary=function(){return parseInt(this.attributes.id,10)>=1e9},t.prototype.getCohort=function(){return this.attributes.cohort},t.prototype.getOrganizations=function(){return this.attributes.organizations||[]},t.prototype.getPrimaryOrganization=function(){var e=this.getOrganizations();return e[0]&&"1"!==e[0].id?e[0]:null},t.prototype.getAffiliations=function(){return this.attributes.affiliations},t.prototype.toString=function(){return this.attributes.id},t}(c.default);t.default=f},function(e,t,n){n(26),e.exports=self.fetch.bind(self)},function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var c,f,l,d,h=s.test(e),p=typeof t,y=this,m=0;for("object"!==p&&"string"!==p&&(n=t,t=null),n&&"function"!=typeof n&&(n=a.parse),t=i(t);m<u.length;m++)f=u[m],c=f[0],d=f[1],c!==c?y[d]=e:"string"==typeof c?~(l=e.indexOf(c))&&("number"==typeof f[2]?(y[d]=e.slice(0,l),e=e.slice(l+f[2])):(y[d]=e.slice(l),e=e.slice(0,l))):(l=c.exec(e))&&(y[d]=l[1],e=e.slice(0,e.length-l[0].length)),y[d]=y[d]||(f[3]||"port"===d&&h?t[d]||"":""),f[4]&&(y[d]=y[d].toLowerCase());n&&(y.query=n(y.query)),o(y.port,y.protocol)||(y.host=y.hostname,y.port=""),y.username=y.password="",y.auth&&(f=y.auth.split(":"),y.username=f[0]||"",y.password=f[1]||""),y.href=y.toString()}var o=n(24),i=n(25),a=n(23),s=/^\/(?!\/)/,u=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];r.prototype.set=function(e,t,n){var r=this;return"query"===e?("string"==typeof t&&t.length&&(t=(n||a.parse)(t)),r[e]=t):"port"===e?(r[e]=t,o(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="")):"hostname"===e?(r[e]=t,r.port&&(t+=":"+r.port),r.host=t):"host"===e?(r[e]=t,/\:\d+/.test(t)&&(t=t.split(":"),r.hostname=t[0],r.port=t[1])):r[e]=t,r.href=r.toString(),r},r.prototype.toString=function(e){e&&"function"==typeof e||(e=a.stringify);var t,n=this,r=n.protocol+"//";return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.hostname,n.port&&(r+=":"+n.port),r+=n.pathname,t="object"==typeof n.query?e(n.query):n.query,t&&(r+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(r+=n.hash),r},r.qs=a,r.location=i,e.exports=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(2),a=r(i),s=n(9),u=r(s),c=n(10),f=r(c),l=n(1),d=r(l),h=n(3),p=r(h),y=n(8),m=r(y),g=function(e){return new Promise(function(t){return setTimeout(t,e)})},v=function(){function e(){o(this,e),this._activeDeviceCodeModel=null}return e.refreshExistingAccessToken=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!a.default.config.authProxyBaseUrl)throw new TypeError("OAuth proxy not configured. Unable to refresh the access token.");if(!a.default.accessToken&&!a.default.refreshToken)throw new TypeError("An access token or refresh token must be set in order to attempt a refresh.");d.default.debug("Access token appears to have expired. Attempting to generate a fresh one.");var r=""+a.default.config.authProxyBaseUrl+a.default.config.refreshTokenPath,o={method:"POST",credentials:"include"};return a.default.refreshToken&&(o.body="token="+a.default.refreshToken),p.default.nprApiFetch(r,o).then(function(e){var t=new u.default(e);return t.validate(),d.default.debug("Access token refresh was successful, new token:",t.toString()),a.default.accessToken=t.token,t.refreshToken&&(a.default.refreshToken=t.refreshToken),t}).catch(function(r){return d.default.debug("Error generating a new token in refreshExistingAccessToken()"),d.default.debug(r),n<2?(d.default.debug("refreshExistingAccessToken() will make another attempt"),g(5e3).then(e.refreshExistingAccessToken.bind(t,n+1))):(d.default.debug("refreshExistingAccessToken() has made too many attempts, aborting"),Promise.reject(r))})},e.prototype.logout=function(){if(!a.default.accessToken&&!a.default.refreshToken)throw new TypeError("An access token or refresh token must be set in order to attempt a logout.");if(!a.default.config.authProxyBaseUrl)throw new TypeError("OAuth proxy not configured. Unable to securely log out the user.");var e=""+a.default.config.authProxyBaseUrl+a.default.config.logoutPath,t={method:"POST",credentials:"include",body:"token="+(a.default.accessToken||a.default.refreshToken)+"&token_type_hint="+(a.default.accessToken?"access_token":"refresh_token"),
headers:{Accept:"application/json, application/xml, text/plain, text/html, *.*","Content-Type":"application/x-www-form-urlencoded; charset=utf-8"}};return fetch(e,t).then(function(e){return e.ok?(a.default.accessToken="",a.default.refreshToken="",!0):p.default.formatErrorResponse(e)})},e.prototype.getDeviceCode=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!a.default.config.authProxyBaseUrl)throw new TypeError("OAuth proxy not configured. Unable to use the device code.");var n=""+a.default.config.authProxyBaseUrl+a.default.config.newDeviceCodePath,r={method:"POST",credentials:"include",body:"scope="+encodeURIComponent(t.join(" ")).replace("%20","+"),headers:{Accept:"application/json, application/xml, text/plain, text/html, *.*","Content-Type":"application/x-www-form-urlencoded; charset=utf-8"}};return p.default.nprApiFetch(n,r).then(function(t){var n=new f.default(t);return n.validate(),e._activeDeviceCodeModel=n,n})},e.prototype.pollDeviceCode=function(){if(d.default.debug("Starting to poll device code. Will poll until user logs in or code expires"),!a.default.config.authProxyBaseUrl)throw new TypeError("OAuth proxy not configured. Unable to use the device code.");if(!this._activeDeviceCodeModel)throw new TypeError("No active device code set. Please call getDeviceCode() before calling this function.");return this._pollDeviceCodeOnce()},e.prototype._pollDeviceCodeOnce=function(){var e=this;if(d.default.debug("Polling device code once"),this._activeDeviceCodeModel.isExpired())return Promise.reject("The device code has expired. Please generate a new one before continuing.");var t=""+a.default.config.authProxyBaseUrl+a.default.config.pollDeviceCodePath,n={method:"POST",credentials:"include"};return this._activeDeviceCodeModel.deviceCode&&(n.body="code="+this._activeDeviceCodeModel.deviceCode),p.default.nprApiFetch(t,n).then(function(e){d.default.debug("Device code poll returned successfully! An access token was returned.");var t=new u.default(e);return t.validate(),a.default.accessToken=t.token,t.refreshToken&&(a.default.refreshToken=t.refreshToken),t}).catch(function(t){if(t instanceof m.default)if(401===t.statusCode){if("authorization_pending"===t.json.type)return g(e._activeDeviceCodeModel.interval).then(e._pollDeviceCodeOnce.bind(e));d.default.debug('The response was a 401, but not of type "authorization_pending". The user presumably denied the app access; rejecting.')}else d.default.debug("Response was not a 401. The device code has probably expired; rejecting.");else d.default.debug("An unknown type of error was received. Unsure of how to respond; rejecting.");return Promise.reject(t)})},e}();t.default=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(2),a=r(i),s=n(3),u=r(s),c=n(14),f=r(c),l=n(1),d=r(l),h=n(9),p=r(h),y=n(7),m=r(y),g=function(){function e(){o(this,e)}return e.prototype.getUser=function(){var e=a.default.getServiceUrl("identity")+"/user";return u.default.nprApiFetch(e).then(function(e){return new f.default(e)})},e.prototype.setUserStation=function(e){return m.default.validateStation(e).then(function(){var t=a.default.getServiceUrl("identity")+"/stations",n={method:"PUT",body:JSON.stringify([e])};return u.default.nprApiFetch(t,n).then(function(e){return new f.default(e)})}).catch(function(e){return d.default.debug("setUserStation failed, message: ",e),Promise.reject(e)})},e.prototype.followShow=function(e){return this._setFollowingStatusForShow(e,!0)},e.prototype.unfollowShow=function(e){return this._setFollowingStatusForShow(e,!1)},e.prototype._setFollowingStatusForShow=function(e,t){var n=parseInt(e,10);if(isNaN(n)||!isFinite(n))throw new TypeError("Aggregation (show) ID must be an integer greater than 0");var r={id:e,following:t},o=a.default.getServiceUrl("identity")+"/following",i={method:"POST",body:JSON.stringify(r)};return u.default.nprApiFetch(o,i).then(function(e){return new f.default(e)})},e.prototype.createTemporaryUser=function(){if(!a.default.config.authProxyBaseUrl)throw new TypeError("OAuth proxy not configured. Unable to create temporary users.");if(!a.default.config.clientId)throw new TypeError("A client ID must be set for temporary user requests.");var e=""+a.default.config.authProxyBaseUrl+a.default.config.tempUserPath,t=e.indexOf("?")>=0?"&":"?";e=""+e+t+"clientId="+a.default.config.clientId;var n={credentials:"include"};return u.default.nprApiFetch(e,n).then(function(e){var t=new p.default(e);return t.validate(),a.default.accessToken=t.token,t})},e}();t.default=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=n(2),a=r(i),s=n(20),u=r(s),c=n(5),f=r(c),l=n(11),d=r(l),h=n(1),p=r(h),y=n(3),m=r(y),g=function(){function e(){var t=this;o(this,e),this._queuedRatings=[],this._sentRatings=[],this._flowRecommendations=[],this._flowFetchActive=!1,this._flowPromise=null,this._adsBlocked=!1,this._channelRecommendations={},fetch("https://adswizz.com",{mode:"no-cors"}).catch(function(){fetch("https://delivery-s3.adswizz.com",{mode:"no-cors"}).catch(function(e){p.default.debug("Ads are blocked. ",e),t._adsBlocked=!0})})}return e.prototype.getRecommendation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"npr";return this._flowPromise=this._advanceFlowRecommendations(t,e),this._flowPromise},e.prototype.getUpcomingFlowRecommendations=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"npr";return this._flowRecommendations.length>0?Promise.resolve(this._flowRecommendations):this._getChannelRecommendations(e)},e.prototype.getRecommendationsFromChannel=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"recommended",n=t&&"string"==typeof t?t:"recommended",r=Promise.resolve(!0);return this._queuedRatings.length>0&&(r=this._sendRatings()),r.then(this._getChannelRecommendations.bind(this,n,null)).then(function(t){return e._channelRecommendations||(e._channelRecommendations={}),e._channelRecommendations[n]=t,t})},e.prototype.queueRecommendationFromChannel=function(e,t){if(!e||"string"!=typeof e)throw new TypeError("Must pass in a valid channel to queueRecommendationFromChannel()");if(!t||"string"!=typeof t)throw new TypeError("Must pass in a valid uid to queueRecommendationFromChannel()");if(!(e in this._channelRecommendations)||0===this._channelRecommendations[e].length)throw new Error('Results from channel "'+e+'" are not cached. You must call getRecommendationsFromChannel() first.');for(var n=this._channelRecommendations[e],r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;if(a.attributes.uid===t)return this._flowRecommendations?this._flowRecommendations=[a].concat(this._flowRecommendations):this._flowRecommendations=[a],a}throw new Error("Unable to find story with uid "+t+" "+('in cached list of recommendations from channel "'+e+'".'))},e.prototype.getHistory=function(){var e=a.default.getServiceUrl("listening")+"/history";return m.default.nprApiFetch(e).then(this._createRecommendations.bind(this))},e.prototype.resetFlow=function(){var e=this,t=Promise.resolve(!0);return this._flowRecommendations&&this._flowRecommendations.length?(this._queuedRatings.length>0&&(t=this._sendRatings(!1)),t.then(function(){return e._flowRecommendations=[],e._flowFetchActive=!1,e._flowPromise=null,!0})):t},e.prototype.resumeFlowFromRecommendation=function(e){var t=this._createRecommendations(e);return this._flowRecommendations=t,this._flowRecommendations[0]},e.prototype._advanceFlowRecommendations=function(e,t){var n=this;if(this._flowFetchActive)return p.default.debug("A listening service API request is already active, returning existing promise if one exists."),this._flowPromise?this._flowPromise:Promise.reject(new Error("No recommendations available. Try again later."));if(t&&this._flowRecommendations&&this._flowRecommendations.length>0){var r=!1;if(this._flowRecommendations.forEach(function(e,o){r||e.attributes.uid!==t||(n._flowRecommendations=n._flowRecommendations.slice(o),r=!0)}),r)return p.default.debug("Recommendation with UID "+t+" was already queued up. Returning the cached version instead of making a new API call."),Promise.resolve(this._flowRecommendations[0])}return this._flowFetchActive=!0,this._getFlowRecommendations(e,t).then(function(e){if(n._flowFetchActive=!1,e.length<=0&&p.default.error("API returned no recommendations."),n._flowRecommendations=n._filterIncomingRecommendations(e),!n._flowRecommendations[0])throw new Error("All recommendations exhausted!");return n._flowRecommendations[0]}).catch(function(e){throw n._flowFetchActive=!1,e})},e.prototype._filterIncomingRecommendations=function(e){if(this._adsBlocked){var t=e.length,n=e.filter(function(e){return!e.isSponsorship()}),r=t-n.length;return r>0&&p.default.debug("Filtered "+r+" ad(s)."),n}return e},e.prototype._recordRating=function(e){if(!this._queuedRatingsContainsRating(e)){p.default.debug("Queued rating: "+e),this._queuedRatings.push(e);for(var t=f.default.getFlowAdvancingActions(),n=Array.isArray(t),r=0,t=n?t:t[Symbol.iterator]();;){var o;if(n){if(r>=t.length)break;o=t[r++]}else{if(r=t.next(),r.done)break;o=r.value}var i=o;if(e.rating===i){this.getRecommendation();break}}}},e.prototype._getFlowRecommendations=function(e,t){for(var n=f.default.getFlowAdvancingActions(),r=Array.isArray(n),o=0,n=r?n:n[Symbol.iterator]();;){var i;if(r){if(o>=n.length)break;i=n[o++]}else{if(o=n.next(),o.done)break;i=o.value}var a=i;if(this._queuedRatingsContainsAction(a))return this._sendRatings()}return!t&&this._flowRecommendations.length>0?Promise.resolve(this._flowRecommendations):this._getChannelRecommendations(e,t)},e.prototype._getChannelRecommendations=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e&&"string"==typeof e?e:"npr",r=a.default.getServiceUrl("listening")+"/recommendations?channel="+n;return r+=t?"&sharedMediaId="+t:"",m.default.nprApiFetch(r).then(this._createRecommendations.bind(this))},e.prototype._createRecommendations=function(e){var t=(0,u.default)(e),n=this._recordRating.bind(this);return t.map(function(e){return e.setRatingReceivedCallback(n)}),t},e.prototype._sendRatings=function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0===this._queuedRatings.length)return p.default.error("Things have gone drastically wrong, this: ",this),Promise.reject(new Error("No queued ratings to send."));var n=a.default.getServiceUrl("listening");if(n+="/ratings?recommend="+t.toString(),t){var r=this._queuedRatings.slice(-1).pop();n=r._actionUrl&&r.rating===f.default.TAPTHRU?r._actionUrl:r._recommendationUrl}var o=[];this._queuedRatings.forEach(function(e){e._hasSent||o.push(e)});var i={method:"POST",body:JSON.stringify(o,d.default.privateMemberReplacer)};return p.default.debug("Sending Ratings: ",o.join(", ")),m.default.nprApiFetch(n,i).then(function(t){return o.forEach(function(t){var n=t;n._hasSent=!0,e._sentRatings.push(n),e._queuedRatings.splice(e._queuedRatings.indexOf(n),1)}),e._createRecommendations(t)})},e.prototype._queuedRatingsContainsRating=function(e){return this._queuedRatings.some(function(t){return t.rating===e.rating&&t.mediaId===e.mediaId})},e.prototype._queuedRatingsContainsAction=function(e){return this._queuedRatings.some(function(t){return t.rating===e})},e}();t.default=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){a.default.validateCollectionDoc(e);var t=[];return e.items.forEach(function(e){try{t.push(new u.default(e))}catch(n){f.default.warn("Recommendation is invalid and has been excluded.",n)}}),t}t.__esModule=!0,t.default=o;var i=n(4),a=r(i),s=n(12),u=r(s),c=n(1),f=r(c)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){function t(){e.apply(this,arguments)}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n(this,t);var o=r(this,Object.getPrototypeOf(t).call(this,e));return Object.defineProperty(o,"message",{configurable:!0,enumerable:!1,value:e,writable:!0}),Object.defineProperty(o,"name",{configurable:!0,enumerable:!1,value:o.constructor.name,writable:!0}),Error.hasOwnProperty("captureStackTrace")?(Error.captureStackTrace(o,o.constructor),r(o)):(Object.defineProperty(o,"stack",{configurable:!0,enumerable:!1,value:new Error(e).stack,writable:!0}),o)}return o(t,e),t}(i(Error));t.default=a,e.exports=t.default},function(e,t,n){var r,o;!function(i){"use strict";var a={};a.VERSION="1.3.0";var s,u={},c=function(e,t){return function(){return t.apply(e,arguments)}},f=function(){var e,t,n=arguments,r=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in r||!n[t].hasOwnProperty(e)||(r[e]=n[t][e]);return r},l=function(e,t){return{value:e,name:t}};a.DEBUG=l(1,"DEBUG"),a.INFO=l(2,"INFO"),a.TIME=l(3,"TIME"),a.WARN=l(4,"WARN"),a.ERROR=l(8,"ERROR"),a.OFF=l(99,"OFF");var d=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};d.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(a.DEBUG,arguments)},info:function(){this.invoke(a.INFO,arguments)},warn:function(){this.invoke(a.WARN,arguments)},error:function(){this.invoke(a.ERROR,arguments)},time:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"start"])},timeEnd:function(e){"string"==typeof e&&e.length>0&&this.invoke(a.TIME,[e,"end"])},invoke:function(e,t){s&&this.enabledFor(e)&&s(t,f({level:e},this.context))}};var h=new d({filterLevel:a.OFF});!function(){var e=a;e.enabledFor=c(h,h.enabledFor),e.debug=c(h,h.debug),e.time=c(h,h.time),e.timeEnd=c(h,h.timeEnd),e.info=c(h,h.info),e.warn=c(h,h.warn),e.error=c(h,h.error),e.log=e.info}(),a.setHandler=function(e){s=e},a.setLevel=function(e){h.setLevel(e);for(var t in u)u.hasOwnProperty(t)&&u[t].setLevel(e)},a.get=function(e){return u[e]||(u[e]=new d(f({name:e},h.context)))},a.createDefaultHandler=function(e){e=e||{},e.formatter=e.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var t={},n=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(r,o){r=Array.prototype.slice.call(r);var i,s=console.log;o.level===a.TIME?(i=(o.name?"["+o.name+"] ":"")+r[0],"start"===r[1]?console.time?console.time(i):t[i]=(new Date).getTime():console.timeEnd?console.timeEnd(i):n(s,[i+": "+((new Date).getTime()-t[i])+"ms"])):(o.level===a.WARN&&console.warn?s=console.warn:o.level===a.ERROR&&console.error?s=console.error:o.level===a.INFO&&console.info&&(s=console.info),e.formatter(r,o),n(s,r))}},a.useDefaults=function(e){a.setLevel(e&&e.defaultLevel||a.DEBUG),a.setHandler(a.createDefaultHandler(e))},r=a,o="function"==typeof r?r.call(t,n,t,e):r,!(void 0!==o&&(e.exports=o))}(this)},function(e,t){"use strict";function n(e){for(var t,n=/([^=?&]+)=?([^&]*)/g,r={};t=n.exec(e);r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]));return r}function r(e,t){t=t||"";var n=[];"string"!=typeof t&&(t="?");for(var r in e)o.call(e,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return n.length?t+n.join("&"):""}var o=Object.prototype.hasOwnProperty;t.stringify=r,t.parse=n},function(e,t){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,n){(function(t){"use strict";var r,o={hash:1,query:1};e.exports=function(e){e=e||t.location||{},r=r||n(16);var i,a={},s=typeof e;if("blob:"===e.protocol)a=new r(unescape(e.pathname),{});else if("string"===s){a=new r(e,{});for(i in o)delete a[i]}else if("object"===s)for(i in e)i in o||(a[i]=e[i]);return a}}).call(t,function(){return this}())},function(e,t){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return y.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function i(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function a(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function s(e){var t=new FileReader;return t.readAsArrayBuffer(e),a(t)}function u(e){var t=new FileReader;return t.readAsText(e),a(t)}function c(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(y.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(y.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(e){if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob?(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(s)},this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=i(this);return e?e:Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(e){var t=e.toUpperCase();return m.indexOf(t)>-1?t:e}function l(e,t){t=t||{};var n=t.body;if(l.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=f(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function d(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function h(e){var t=new o,n=(e.getAllResponseHeaders()||"").trim().split("\n");return n.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function p(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof o?t.headers:new o(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var y={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};o.prototype.append=function(e,r){e=t(e),r=n(r);var o=this.map[e];o||(o=[],this.map[e]=o),o.push(r)},o.prototype.delete=function(e){delete this.map[t(e)]},o.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},o.prototype.getAll=function(e){return this.map[t(e)]||[]},o.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},o.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},o.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},y.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];l.prototype.clone=function(){return new l(this)},c.call(l.prototype),c.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var g=[301,302,303,307,308];p.redirect=function(e,t){if(g.indexOf(t)===-1)throw new RangeError("Invalid status code");return new p(null,{status:t,headers:{location:e}})},e.Headers=o,e.Request=l,e.Response=p,e.fetch=function(e,t){return new Promise(function(n,r){function o(){return"responseURL"in a?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):void 0}var i;i=l.prototype.isPrototypeOf(e)&&!t?e:new l(e,t);var a=new XMLHttpRequest;a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:h(a),url:o()},t="response"in a?a.response:a.responseText;n(new p(t,e))},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request failed"))},a.open(i.method,i.url,!0),"include"===i.credentials&&(a.withCredentials=!0),"responseType"in a&&y.blob&&(a.responseType="blob"),i.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)}])});
//# sourceMappingURL=npr-one-sdk.min.js.map